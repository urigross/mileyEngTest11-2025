<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×”×›× ×” ×œ××‘×—×Ÿ ×‘×× ×’×œ×™×ª - ×“'</title>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --text-color: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            color: var(--text-color);
            user-select: none;
        }

        /* --- ×›×•×ª×¨×ª ×•× ×™×§×•×“ --- */
        .header-container {
            position: relative;
            margin-bottom: 20px;
        }

        .score-badge {
            background-color: #f1c40f;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            position: absolute;
            left: 0;
            top: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1 { color: #5c6bc0; margin: 0; font-size: 1.5rem; }
        h3 { margin: 5px 0 20px 0; color: #666; font-weight: normal; font-size: 1rem; }

        /* --- ×’×¨×™×“ ×”×›×¤×ª×•×¨×™× --- */
        #main-menu {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }

        .menu-btn {
            border: none; border-radius: 10px; padding: 15px;
            font-size: 1rem; color: white; cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            min-height: 80px; font-weight: bold;
        }

        .menu-btn:active { transform: translateY(4px); box-shadow: none; }
        .menu-btn span { font-size: 1.5rem; margin-bottom: 5px; }

        /* ×¦×‘×¢×™× */
        .btn-blue { background-color: #5d8cd6; }
        .btn-red { background-color: #c94b38; }
        .btn-green { background-color: #6ab063; }
        .btn-orange { background-color: #d38428; }
        .btn-dark { background-color: #3e4a59; }
        .btn-purple { background-color: #8e5ea2; }
        .btn-teal { background-color: #62a3b7; grid-column: 1 / -1; }
        .btn-gold { background-color: #dcb028; }
        
        .settings-btn-small {
            position: absolute; right: 0; top: 0;
            background: none; border: none; font-size: 1.5rem;
            cursor: pointer; color: #777;
        }

        /* --- ××–×•×¨×™ ×”××©×—×§ ×•×”×”×’×“×¨×•×ª --- */
        .game-container, #settings-screen {
            display: none; background: white; padding: 20px;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            max-width: 600px; margin: 20px auto; width: 100%;
        }
        
        .active { display: block; }
        .back-btn { background-color: #eee; color: #333; width: 100%; margin-top: 20px; }

        /* --- ×¢×™×¦×•×‘×™× ×¡×¤×¦×™×¤×™×™× ×œ××©×—×§×™× --- */
        #tf-image-container img, #writing-image-container img, #reading-image-container img, #listening-options img {
            max-width: 100%; max-height: 200px; border-radius: 10px; margin: 10px 0; border:2px solid #eee;
        }

        /* ×××ª ××• ×©×§×¨ */
        .tf-buttons { display: flex; gap: 15px; }
        .tf-btn { flex: 1; padding: 15px; border-radius: 10px; border: none; color: white; font-size: 1.2rem; cursor: pointer; }
        .btn-true { background-color: #4CAF50; }
        .btn-false { background-color: #f44336; }

        /* ×¡× ×™×™×§ */
        #snake-board { width: 300px; height: 300px; background-color: #333; margin: 10px auto; position: relative; border-radius: 5px; }
        .snake-part { width: 20px; height: 20px; background-color: lime; position: absolute; border-radius: 3px; }
        .food-item { width: 20px; height: 20px; background-color: red; position: absolute; border-radius: 50%; }

        /* ×–×™×›×¨×•×Ÿ */
        .memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .memory-card { background-color: #2196F3; height: 80px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; }
        .memory-card.flipped { background-color: white; color: #333; border: 2px solid #2196F3; }
        .memory-card.matched { background-color: #8BC34A; border-color: #8BC34A; opacity: 0.5; pointer-events: none; }
        .memory-card img { max-width: 90%; max-height: 90%; }

        /* ×›×ª×™×‘×” */
        #writing-input { font-size: 1.5rem; padding: 10px; border-radius: 10px; border: 2px solid #ccc; text-align: center; width: 80%; direction: ltr; margin-bottom: 10px; }
        
        /* ×”×©×œ××ª ××©×¤×˜×™× */
        .sentence-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .sentence-btn { background-color: #5d8cd6; color: white; border: none; padding: 15px; border-radius: 10px; font-size: 1.2rem; cursor: pointer; }

        /* ×§×¨×™××” ×•×”×‘× ×ª ×”× ×©××¢ */
        .image-grid-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .option-card { border: 2px solid #ddd; border-radius: 10px; padding: 5px; cursor: pointer; transition: 0.2s; }
        .option-card:hover { border-color: #2196F3; background-color: #f0f8ff; }
        .option-card img { max-width: 100%; height: 100px; object-fit: contain; }
        
        .play-sound-btn { background-color: #8e5ea2; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 30px; cursor: pointer; margin-bottom: 20px; }

        /* ×”×’×“×¨×•×ª */
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; vertical-align: middle; margin-left: 10px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        input:checked + .slider { background-color: #2196F3; }
        input:checked + .slider:before { transform: translateX(22px); position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; border-radius: 50%; transition: .4s; }

    </style>
</head>
<body>

    <div class="header-container">
        <div class="score-badge">× ×™×§×•×“: <span id="total-score">0</span></div>
        <button class="settings-btn-small" onclick="showSettings()">âš™ï¸</button>
        <h1>×”×›× ×” ×œ××‘×—×Ÿ ×‘×× ×’×œ×™×ª - ×“'</h1>
        <h3>×›×œ ×”××™×œ×™× + ××©×¤×˜×™×</h3>
    </div>

    <div id="main-menu" class="active">
        <button class="menu-btn btn-blue" onclick="showGame('listening')">
            <span>ğŸ‘‚</span> ×”×‘× ×ª ×”× ×©××¢
        </button>
        <button class="menu-btn btn-blue" onclick="showGame('writing')">
            <span>âœï¸</span> ×›×ª×™×‘×ª ××™×œ×™×
        </button>

        <button class="menu-btn btn-blue" onclick="showGame('sentences')">
            <span>ğŸ§©</span> ×”×©×œ××ª ××©×¤×˜×™×
        </button>
        <button class="menu-btn btn-blue" onclick="showGame('reading')">
            <span>ğŸ“–</span> ×§×¨×™××”
        </button>

        <button class="menu-btn btn-green" onclick="alert('××©×—×§ ×–×” ×¢×“×™×™×Ÿ ×‘×‘× ×™×™×” (××¤×¢×œ)')">
            <span>ğŸ—ï¸</span> ××¤×¢×œ ×”××©×¤×˜×™×
        </button>
        <button class="menu-btn btn-red" onclick="alert('××©×—×§ ×–×” ×¢×“×™×™×Ÿ ×‘×‘× ×™×™×” (×§×œ×™×§)')">
            <span>âš¡</span> ×§×œ×™×§ ××”×™×¨
        </button>

        <button class="menu-btn btn-dark" onclick="alert('××©×—×§ ×–×” ×¢×“×™×™×Ÿ ×‘×‘× ×™×™×” (×‘×•×¢×•×ª)')">
            <span>ğŸ«§</span> ×¤×™×¦×•×¥ ×‘×•×¢×•×ª
        </button>
        <button class="menu-btn btn-orange" onclick="showGame('truefalse')">
            <span>âœ…</span> ×××ª ××• ×©×§×¨
        </button>

        <button class="menu-btn btn-purple" style="grid-column: 1 / -1;" onclick="showGame('snake')">
            <span>ğŸ</span> ×¡× ×™×™×§ ××™×œ×™×
        </button>

        <button class="menu-btn btn-orange" style="grid-column: 1 / -1;" onclick="showGame('memory')">
            <span>ğŸƒ</span> ××©×—×§ ×”×–×™×›×¨×•×Ÿ
        </button>

        <button class="menu-btn btn-teal">
            <span>ğŸ“œ</span> ×¢×“×›×•× ×™×
        </button>
        
        <button class="menu-btn btn-gold" style="grid-column: 1 / -1;">
            <span>ğŸ†</span> ×©×™××™×
        </button>
    </div>

    <div id="settings-screen">
        <h2>×”×’×“×¨×•×ª ××¢×¨×›×ª</h2>
        <div style="text-align: right; padding: 10px; border-bottom: 1px solid #eee;">
            <label class="switch">
                <input type="checkbox" id="progressive-toggle" onchange="toggleProgressiveMode()">
                <span class="slider"></span>
            </label>
            <strong>×œ××™×“×” ×¤×¨×•×’×¨×¡×™×‘×™×ª</strong>
            <p style="font-size:0.9rem; color:#666;">×›××©×¨ ×¤×¢×™×œ: ××™×œ×™× ×©×™×“×¢×ª ×œ× ×™×•×¤×™×¢×• ×©×•×‘.</p>
        </div>
        <br>
        <button id="reset-progress-btn" class="menu-btn btn-red" style="width:100%; font-size:1rem;" onclick="resetProgress()" disabled>
            ××™×¤×•×¡ ×”×ª×§×“××•×ª â†º
        </button>
        <button class="menu-btn back-btn" onclick="showMainMenu()">×—×–×•×¨ ×œ×ª×¤×¨×™×˜</button>
    </div>

    <div id="snake-game" class="game-container">
        <h2>×¡× ×™×™×§ ××™×œ×™×</h2>
        <p>××›×•×œ ××ª ×”××™×œ×”: <span id="target-word-snake" style="font-weight:bold; color:blue;"></span></p>
        <div id="snake-board"></div>
        <button class="menu-btn back-btn" onclick="endGame()">×™×¦×™××” ×œ×ª×¤×¨×™×˜</button>
    </div>

    <div id="tf-game" class="game-container">
        <h2>×××ª ××• ×©×§×¨?</h2>
        <h2 id="tf-word">××™×œ×”</h2>
        <div id="tf-image-container"></div>
        <div class="tf-buttons">
            <button class="tf-btn btn-true" onclick="checkTF(true)">×××ª</button>
            <button class="tf-btn btn-false" onclick="checkTF(false)">×©×§×¨</button>
        </div>
        <button class="menu-btn back-btn" onclick="endGame()">×™×¦×™××” ×œ×ª×¤×¨×™×˜</button>
    </div>

    <div id="memory-game" class="game-container">
        <h2>××©×—×§ ×”×–×™×›×¨×•×Ÿ</h2>
        <div id="memory-board" class="memory-grid"></div>
        <button class="menu-btn back-btn" onclick="endGame()">×™×¦×™××” ×œ×ª×¤×¨×™×˜</button>
    </div>

    <div id="writing-game" class="game-container">
        <h2>×›×ª×™×‘×ª ××™×œ×™×</h2>
        <p>×›×ª×•×‘ ××ª ×”××™×œ×” ×‘×× ×’×œ×™×ª:</p>
        <div id="writing-image-container"></div>
        <input type="text" id="writing-input" placeholder="Type here..." autocomplete="off">
        <button class="menu-btn btn-blue" style="width:100%; margin-top:10px;" onclick="checkWriting()">×‘×“×™×§×”</button>
        <button class="menu-btn back-btn" onclick="endGame()">×™×¦×™××” ×œ×ª×¤×¨×™×˜</button>
    </div>

    <div id="sentences-game" class="game-container">
        <h2>×”×©×œ××ª ××©×¤×˜×™×</h2>
        <h3 id="sentence-text" style="direction: ltr; font-size: 1.3rem; margin: 20px;">The dog is ___ the table.</h3>
        <div id="sentence-options" class="sentence-options"></div>
        <button class="menu-btn back-btn" onclick="endGame()">×™×¦×™××” ×œ×ª×¤×¨×™×˜</button>
    </div>

    <div id="reading-game" class="game-container">
        <h2>×§×¨×™××” ×•×”×ª×××”</h2>
        <p>×‘×—×¨ ××ª ×”×ª××•× ×” ×”××ª××™××” ×œ××™×œ×”:</p>
        <h1 id="reading-word" style="font-size: 2.5rem; color: #5d8cd6; font-family: sans-serif;">Cat</h1>
        <div id="reading-options" class="image-grid-options"></div>
        <button class="menu-btn back-btn" onclick="endGame()">×™×¦×™××” ×œ×ª×¤×¨×™×˜</button>
    </div>

    <div id="listening-game" class="game-container">
        <h2>×”×‘× ×ª ×”× ×©××¢</h2>
        <p>×œ×—×¥ ×¢×œ ×”×¨××§×•×œ ×•×‘×—×¨ ××ª ×”×ª××•× ×”:</p>
        <button class="play-sound-btn" onclick="playCurrentWord()">ğŸ”Š</button>
        <div id="listening-options" class="image-grid-options"></div>
        <button class="menu-btn back-btn" onclick="endGame()">×™×¦×™××” ×œ×ª×¤×¨×™×˜</button>
    </div>

    <audio id="chew-sound" src="https://www.soundjay.com/human/sounds/eating-chip-1.mp3"></audio>

<script>
    // --- ×××’×¨ × ×ª×•× ×™× ××™×œ×™× ---
    const allWords = [
        { id: 1, word: "House", image: "https://cdn-icons-png.flaticon.com/512/619/619032.png" },
        { id: 2, word: "Heart", image: "https://cdn-icons-png.flaticon.com/512/833/833472.png" },
        { id: 3, word: "Dog", image: "https://cdn-icons-png.flaticon.com/512/616/616408.png" },
        { id: 4, word: "Cat", image: "https://cdn-icons-png.flaticon.com/512/616/616430.png" },
        { id: 5, word: "Sun", image: "https://cdn-icons-png.flaticon.com/512/869/869869.png" },
        { id: 6, word: "Tree", image: "https://cdn-icons-png.flaticon.com/512/490/490091.png" },
        { id: 7, word: "Car", image: "https://cdn-icons-png.flaticon.com/512/741/741407.png" },
        { id: 8, word: "Ball", image: "https://cdn-icons-png.flaticon.com/512/326/326031.png" },
        { id: 9, word: "Book", image: "https://cdn-icons-png.flaticon.com/512/3330/3330314.png" },
        { id: 10, word: "Apple", image: "https://cdn-icons-png.flaticon.com/512/415/415733.png" }
    ];

    // --- ×××’×¨ × ×ª×•× ×™× ××©×¤×˜×™× (×—×“×©!) ---
    const allSentences = [
        { text: "The cat is ___ the table.", answer: "on", options: ["in", "on", "at"] },
        { text: "I ___ an apple.", answer: "have", options: ["has", "have", "is"] },
        { text: "She ___ to school.", answer: "goes", options: ["go", "goes", "going"] },
        { text: "The dog is ___.", answer: "big", options: ["big", "run", "eat"] },
        { text: "We ___ happy.", answer: "are", options: ["is", "am", "are"] }
    ];

    let activeWords = [];
    let activeSentences = [];
    let knownWords = JSON.parse(localStorage.getItem('knownWords')) || [];
    let isProgressive = localStorage.getItem('isProgressive') === 'true';
    let currentScore = 0;

    // ××ª×—×•×œ
    updateSettingsUI();

    // --- ×¤×•× ×§×¦×™×•×ª ××¢×¨×›×ª ---
    function showMainMenu() {
        document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
        document.getElementById('main-menu').classList.add('active');
        document.querySelector('.header-container').style.display = 'block'; 
        stopSnake();
    }

    function showSettings() {
        document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
        document.querySelector('.header-container').style.display = 'none';
        document.getElementById('settings-screen').classList.add('active');
        updateSettingsUI();
    }

    function endGame() { showMainMenu(); }

    function toggleProgressiveMode() {
        isProgressive = document.getElementById('progressive-toggle').checked;
        localStorage.setItem('isProgressive', isProgressive);
        updateSettingsUI();
    }

    function updateSettingsUI() {
        document.getElementById('progressive-toggle').checked = isProgressive;
        document.getElementById('reset-progress-btn').disabled = !isProgressive;
        document.getElementById('reset-progress-btn').style.opacity = isProgressive ? 1 : 0.5;
    }

    function resetProgress() {
        if(confirm("×œ××¤×¡ ×”×ª×§×“××•×ª?")) {
            knownWords = [];
            localStorage.setItem('knownWords', JSON.stringify(knownWords));
            alert("×”×”×ª×§×“××•×ª ××•×¤×¡×”!");
        }
    }

    function addScore(points) {
        currentScore += points;
        document.getElementById('total-score').innerText = currentScore;
    }

    function prepareGameWords(count = 1) {
        let pool = allWords;
        if(isProgressive) pool = allWords.filter(w => !knownWords.includes(w.id));
        
        if (pool.length < count) {
            const needed = count - pool.length;
            const extra = allWords.filter(w => !pool.includes(w)).slice(0, needed);
            pool = pool.concat(extra);
        }
        
        activeWords = pool.sort(() => Math.random() - 0.5);
        return activeWords.length > 0;
    }

    function markWordAsKnown(id) {
        if(isProgressive && !knownWords.includes(id)) {
            knownWords.push(id);
            localStorage.setItem('knownWords', JSON.stringify(knownWords));
        }
    }

    function showGame(type) {
        document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
        document.querySelector('.header-container').style.display = 'none';
        
        if(type === 'snake') {
            prepareGameWords(1);
            document.getElementById('snake-game').classList.add('active');
            initSnakeGame();
        } else if (type === 'truefalse') {
            prepareGameWords(1);
            document.getElementById('tf-game').classList.add('active');
            nextTFRound();
        } else if (type === 'memory') {
            prepareGameWords(6);
            document.getElementById('memory-game').classList.add('active');
            initMemoryGame();
        } else if (type === 'writing') {
            prepareGameWords(1);
            document.getElementById('writing-game').classList.add('active');
            nextWritingRound();
        } else if (type === 'sentences') {
            activeSentences = [...allSentences].sort(() => Math.random() - 0.5);
            document.getElementById('sentences-game').classList.add('active');
            nextSentenceRound();
        } else if (type === 'reading') {
            prepareGameWords(4);
            document.getElementById('reading-game').classList.add('active');
            nextReadingRound();
        } else if (type === 'listening') {
            prepareGameWords(4);
            document.getElementById('listening-game').classList.add('active');
            nextListeningRound();
        }
    }

    // --- ××©×—×§×™× ---
    
    // 1. ×××ª ×©×§×¨
    let currentTFWord, isCorrectTF;
    function nextTFRound() {
        if(activeWords.length === 0) prepareGameWords(1);
        currentTFWord = activeWords[0];
        isCorrectTF = Math.random() < 0.5;
        let imgUrl = isCorrectTF ? currentTFWord.image : allWords.find(w => w.id !== currentTFWord.id).image;
        
        document.getElementById('tf-word').innerText = currentTFWord.word;
        document.getElementById('tf-image-container').innerHTML = `<img src="${imgUrl}">`;
    }
    
    function checkTF(ans) {
        if(ans === isCorrectTF) {
            markWordAsKnown(currentTFWord.id);
            activeWords.shift();
            addScore(10);
            alert("× ×›×•×Ÿ!");
            nextTFRound();
        } else {
            alert("×˜×¢×•×ª");
            activeWords.push(activeWords.shift());
            nextTFRound();
        }
    }

    // 2. ×¡× ×™×™×§
    let snake, direction, food, gameInterval;
    function initSnakeGame() {
        snake = [{x: 140, y: 140}];
        direction = "RIGHT";
        spawnSnakeFood();
        document.addEventListener('keydown', changeSnakeDirection);
        document.getElementById('snake-board').addEventListener('click', handleTouchSnake);
        gameInterval = setInterval(drawSnake, 200);
    }
    function stopSnake() { clearInterval(gameInterval); }
    
    function spawnSnakeFood() {
        if(activeWords.length === 0) activeWords = [...allWords];
        const w = activeWords[Math.floor(Math.random()*activeWords.length)];
        document.getElementById('target-word-snake').innerText = w.word;
        food = { x: Math.floor(Math.random()*15)*20, y: Math.floor(Math.random()*15)*20, obj: w };
    }
    
    function changeSnakeDirection(e) {
        const k = e.keyCode;
        if(k==37 && direction!="RIGHT") direction="LEFT";
        if(k==38 && direction!="DOWN") direction="UP";
        if(k==39 && direction!="LEFT") direction="RIGHT";
        if(k==40 && direction!="UP") direction="DOWN";
    }

    function handleTouchSnake(e) {
        const r = e.target.getBoundingClientRect();
        const x = e.clientX - r.left, y = e.clientY - r.top;
        const h = snake[0];
        if(Math.abs(x - h.x) > Math.abs(y - h.y)) direction = (x > h.x) ? "RIGHT" : "LEFT";
        else direction = (y > h.y) ? "DOWN" : "UP";
    }

    function drawSnake() {
        const board = document.getElementById('snake-board');
        board.innerHTML = '';
        let f = document.createElement('div');
        f.className = 'food-item';
        f.style.left=food.x+'px'; f.style.top=food.y+'px';
        board.appendChild(f);
        
        let sx = snake[0].x, sy = snake[0].y;
        if(direction=="LEFT") sx-=20;
        if(direction=="UP") sy-=20;
        if(direction=="RIGHT") sx+=20;
        if(direction=="DOWN") sy+=20;
        
        if(sx==food.x && sy==food.y) {
            markWordAsKnown(food.obj.id);
            if(isProgressive) activeWords = activeWords.filter(w=>w.id!==food.obj.id);
            document.getElementById('chew-sound').play().catch(e=>{});
            addScore(10);
            spawnSnakeFood();
        } else {
            snake.pop();
        }
        
        if(sx<0 || sx>=300 || sy<0 || sy>=300 || snake.some(p=>p.x==sx && p.y==sy)) {
            snake = [{x:140, y:140}];
            return;
        }
        
        snake.unshift({x:sx, y:sy});
        snake.forEach(p => {
            let d = document.createElement('div');
            d.className='snake-part';
            d.style.left=p.x+'px'; d.style.top=p.y+'px';
            board.appendChild(d);
        });
    }

    // 3. ××©×—×§ ×–×™×›×¨×•×Ÿ
    let mLock=false, mFirst, mSecond;
    function initMemoryGame() {
        const board = document.getElementById('memory-board');
        board.innerHTML = '';
        let set = activeWords.slice(0,6);
        let cards = [];
        set.forEach(w => {
            cards.push({id:w.id, content:w.word, type:'text'});
            cards.push({id:w.id, content:`<img src="${w.image}">`, type:'img'});
        });
        cards.sort(()=>Math.random()-0.5);
        
        cards.forEach(c => {
            let div = document.createElement('div');
            div.className = 'memory-card';
            div.innerHTML = c.content;
            div.dataset.id = c.id;
            div.onclick = function() {
                if(mLock || this==mFirst || this.classList.contains('flipped')) return;
                this.classList.add('flipped');
                if(!mFirst) { mFirst=this; return; }
                mSecond=this;
                mLock=true;
                if(mFirst.dataset.id == mSecond.dataset.id) {
                    mFirst.classList.add('matched'); mSecond.classList.add('matched');
                    markWordAsKnown(parseInt(mFirst.dataset.id));
                    addScore(20);
                    mFirst=null; mSecond=null; mLock=false;
                } else {
                    setTimeout(()=>{
                        mFirst.classList.remove('flipped'); mSecond.classList.remove('flipped');
                        mFirst=null; mSecond=null; mLock=false;
                    }, 1000);
                }
            };
            board.appendChild(div);
        });
    }

    // 4. ×›×ª×™×‘×ª ××™×œ×™×
    let currentWritingWord;
    function nextWritingRound() {
        if(activeWords.length === 0) prepareGameWords(1);
        currentWritingWord = activeWords[0];
        document.getElementById('writing-image-container').innerHTML = `<img src="${currentWritingWord.image}">`;
        document.getElementById('writing-input').value = "";
        document.getElementById('writing-input').focus();
    }

    function checkWriting() {
        let inputVal = document.getElementById('writing-input').value.trim().toLowerCase();
        if (inputVal === currentWritingWord.word.toLowerCase()) {
            alert("× ×›×•×Ÿ ×××•×“! ×›×œ ×”×›×‘×•×“.");
            markWordAsKnown(currentWritingWord.id);
            activeWords.shift();
            addScore(15);
            nextWritingRound();
        } else {
            alert("×œ× ×‘×“×™×•×§... × ×¡×” ×©×•×‘. ×”×¨××–: " + currentWritingWord.word[0] + "...");
        }
    }

    // 5. ×”×©×œ××ª ××©×¤×˜×™×
    let currentSentence;
    function nextSentenceRound() {
        if (activeSentences.length === 0) {
            alert("×¡×™×™××ª ××ª ×›×œ ×”××©×¤×˜×™×!");
            endGame();
            return;
        }
        currentSentence = activeSentences[0];
        document.getElementById('sentence-text').innerText = currentSentence.text;
        
        let optsDiv = document.getElementById('sentence-options');
        optsDiv.innerHTML = '';
        currentSentence.options.sort(() => Math.random() - 0.5).forEach(opt => {
            let btn = document.createElement('button');
            btn.className = 'sentence-btn';
            btn.innerText = opt;
            btn.onclick = () => checkSentence(opt);
            optsDiv.appendChild(btn);
        });
    }

    function checkSentence(ans) {
        if (ans === currentSentence.answer) {
            alert("Good job!");
            activeSentences.shift();
            addScore(10);
            nextSentenceRound();
        } else {
            alert("Try again");
        }
    }

    // 6. ×§×¨×™××” (Reading) - ×”×ª×××ª ×ª××•× ×” ×œ××™×œ×”
    let currentReadingWord;
    function nextReadingRound() {
        if(activeWords.length < 4) prepareGameWords(4);
        // ×”××™×œ×” ×”×¨××©×•× ×” ×”×™× ×”××˜×¨×”
        currentReadingWord = activeWords[0];
        document.getElementById('reading-word').innerText = currentReadingWord.word;
        
        // ×œ×•×§×—×™× 4 ××™×œ×™× ×œ×¢×¨×‘×•×‘ (×›×•×œ×œ ×”××˜×¨×”)
        let options = activeWords.slice(0, 4).sort(() => Math.random() - 0.5);
        
        let grid = document.getElementById('reading-options');
        grid.innerHTML = '';
        
        options.forEach(w => {
            let div = document.createElement('div');
            div.className = 'option-card';
            div.innerHTML = `<img src="${w.image}">`;
            div.onclick = () => {
                if (w.id === currentReadingWord.id) {
                    alert("× ×›×•×Ÿ!");
                    markWordAsKnown(currentReadingWord.id);
                    // ××¢×¨×‘×‘×™× ××—×“×© ×œ××©×—×§ ×”×‘×
                    activeWords = activeWords.sort(() => Math.random() - 0.5); 
                    addScore(10);
                    nextReadingRound();
                } else {
                    alert("×œ× × ×›×•×Ÿ");
                }
            };
            grid.appendChild(div);
        });
    }

    // 7. ×”×‘× ×ª ×”× ×©××¢ (Listening)
    let currentListeningWord;
    function nextListeningRound() {
        if(activeWords.length < 4) prepareGameWords(4);
        currentListeningWord = activeWords[0];
        
        let options = activeWords.slice(0, 4).sort(() => Math.random() - 0.5);
        let grid = document.getElementById('listening-options');
        grid.innerHTML = '';
        
        options.forEach(w => {
            let div = document.createElement('div');
            div.className = 'option-card';
            div.innerHTML = `<img src="${w.image}">`;
            div.onclick = () => {
                if (w.id === currentListeningWord.id) {
                    alert("× ×›×•×Ÿ!");
                    markWordAsKnown(currentListeningWord.id);
                    activeWords = activeWords.sort(() => Math.random() - 0.5);
                    addScore(10);
                    nextListeningRound();
                } else {
                    alert("×œ× × ×›×•×Ÿ");
                }
            };
            grid.appendChild(div);
        });
        
        // ×”×©××¢×” ××•×˜×•××˜×™×ª ×‘×”×ª×—×œ×” (××•×¤×¦×™×•× ×œ×™)
        setTimeout(playCurrentWord, 500);
    }

    function playCurrentWord() {
        if (!currentListeningWord) return;
        let utterance = new SpeechSynthesisUtterance(currentListeningWord.word);
        utterance.lang = 'en-US';
        speechSynthesis.speak(utterance);
    }

</script>
</body>
</html>
